<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025ë…„ë„ í•˜ë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œ ìš°ìˆ˜ê³¼ì œ í‰ê°€</title>
    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Malgun Gothic', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); color: white; padding: 30px; text-align: center; cursor: pointer; user-select: none; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .nav-tabs { display: flex; background: #f8f9fa; border-bottom: 2px solid #e9ecef; flex-wrap: wrap; }
        .nav-tab { flex: 1; padding: 15px; text-align: center; background: none; border: none; cursor: pointer; font-size: 1.1em; font-weight: bold; color: #6c757d; transition: all 0.3s ease; min-width: 120px; }
        .nav-tab.active { background: #007bff; color: white; }
        .nav-tab:hover { background: #e9ecef; color: #495057; }
        .nav-tab.active:hover { background: #0056b3; color: white; }
        .content { padding: 30px; }
        .section { display: none; }
        .section.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        .form-group select, .form-group input { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; transition: border-color 0.3s ease; }
        .form-group select:focus, .form-group input:focus { outline: none; border-color: #007bff; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s ease; margin: 10px 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-primary:hover { background: #0056b3; transform: translateY(-2px); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #1e7e34; transform: translateY(-2px); }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; transform: translateY(-2px); }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; transform: translateY(-2px); }
        .evaluation-form { background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 20px; }
        .evaluation-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .evaluation-item label { font-weight: bold; color: #333; margin-bottom: 0; }
        .evaluation-item input { width: 120px; text-align: center; margin-left: 10px; font-size: 1.2em; font-weight: bold; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pagination { display: flex; justify-content: center; align-items: center; margin: 20px 0; }
        .pagination span { margin: 0 15px; font-size: 1.2em; font-weight: bold; color: #007bff; }
        .progress-bar { width: 100%; height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #28a745, #20c997); transition: width 0.3s ease; }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .result-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .result-card:hover { transform: translateY(-5px); }
        .result-card h3 { color: #007bff; margin-bottom: 15px; font-size: 1.3em; }
        .score-detail { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid #e9ecef; }
        .score-detail:last-child { border-bottom: none; }
        .final-score { font-size: 1.5em; font-weight: bold; color: #28a745; text-align: center; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .status-card { padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .status-complete { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-incomplete { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert { padding: 15px; margin-bottom: 20px; border-radius: 10px; font-weight: bold; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .hidden { display: none !important; }
        .evaluation-header { text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #007bff, #0056b3); color: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,123,255,0.3); }
        .evaluation-header h2 { font-size: 2em; margin-bottom: 10px; }
        .evaluation-header p { font-size: 1.1em; opacity: 0.9; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); }
        .modal-content { background-color: white; margin: 15% auto; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-content h3 { margin-bottom: 20px; color: #333; font-size: 1.5em; }
        .modal-content p { margin-bottom: 25px; color: #666; line-height: 1.5; }
        .modal-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }

        .vote-card { background: white; border: 3px solid #e9ecef; border-radius: 15px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .vote-card:hover { border-color: #007bff; transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,123,255,0.2); }
        .vote-card.selected { border-color: #28a745; background: #f0fff4; }
        .vote-card h3 { font-size: 1.8em; margin-bottom: 10px; color: #333; }
        .vote-card p { color: #666; font-size: 1.2em; }
        .admin-section-header { margin-top: 30px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee; color: #007bff; }
        
        @media (max-width: 600px) {
            .evaluation-item { flex-direction: column; alignItems: flex-start; gap: 10px; }
            .evaluation-item input { width: 100%; margin-left: 0; }
            .header h1 { font-size: 1.8em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" id="headerTitle">
            <h1>2025ë…„ë„ í•˜ë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œ ìš°ìˆ˜ê³¼ì œ í‰ê°€</h1>
            <p>(ìƒë‹¨ ì œëª©ì„ 5ë²ˆ í´ë¦­í•˜ë©´ ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë©ë‹ˆë‹¤)</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('evaluator')">ìš°ìˆ˜ê³¼ì œ í‰ê°€</button>
            <button class="nav-tab" onclick="showSection('finalVote')">ğŸ† ìµœì¢… ëŒ€ìƒ íˆ¬í‘œ</button>
            <button class="nav-tab admin-only" onclick="showSection('admin')" style="display: none;">ê´€ë¦¬ì ëª¨ë‹ˆí„°ë§</button>
            <button class="nav-tab admin-only" onclick="showSection('results')" style="display: none;">ê²°ê³¼ í™•ì¸</button>
        </div>
        
        <div class="content">
            <!-- Loading Indicator -->
            <div id="loadingOverlay" style="display: flex; justify-content: center; align-items: center; height: 200px;">
                <div style="font-size: 1.5em; color: #007bff; font-weight: bold;">
                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                </div>
            </div>

            <!-- í‰ê°€ì ì…ì¥ -->
            <div id="evaluator" class="section hidden">
                <div class="alert alert-info" style="margin-bottom: 30px; font-size: 1.1em; line-height: 1.8;">
                    <h3 style="color: #0c5460; margin-bottom: 20px; text-align: center;">
                        ğŸ† 2025ë…„ í•˜ë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œ í‰ê°€ ì•ˆë‚´ ğŸ†
                    </h3>
                    <p style="margin-bottom: 15px;">
                        <strong>2025ë…„ í•˜ë°˜ê¸° ì„œì‹œê³µ ì–´ì›Œë“œì— ì°¸ì—¬í•´ì£¼ì‹  ì„ì§ì› ì—¬ëŸ¬ë¶„ ëª¨ë‘ ê°ì‚¬í•©ë‹ˆë‹¤.</strong>
                    </p>
                    <p style="margin-bottom: 15px;">
                        ì‚¬ì „ì‹¬ì‚¬ë¥¼ í†µí•´ ì„ ë°œëœ <strong>ìš°ìˆ˜ê³¼ì œ 8ê±´</strong>ì— ëŒ€í•œ ë°œí‘œë¥¼ ê²½ì²­í•´ì£¼ì‹œê³ ,<br>
                        ê³µì •í•œ ì‹œê°ìœ¼ë¡œ í‰ê°€ì— ì°¸ì—¬í•´ì£¼ì‹œê¸°ë¥¼ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
                    </p>
                    <p style="text-align: center; font-size: 1.2em; color: #0c5460; font-weight: bold; margin-bottom: 0;">
                        ê·¸ëŸ¼ ì´ì œ í‰ê°€ë¥¼ ì‹œì‘í•´ë³¼ê¹Œìš”^^?
                    </p>
                </div>
                
                <div id="evaluatorLogin" class="evaluation-form">
                    <h2>í‰ê°€ì ì •ë³´ ì…ë ¥</h2>
                    <div class="form-group">
                        <label for="evaluatorType">í‰ê°€ì êµ¬ë¶„</label>
                        <select id="evaluatorType">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="executive">ì„ì›</option>
                            <option value="employee">ì§ì›</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="executiveNameGroup" style="display: none;">
                        <label for="evaluatorPosition">ì§ìœ„</label>
                        <select id="evaluatorPosition">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì´ì‚¬ì¥">ì´ì‚¬ì¥</option>
                            <option value="ê²½ì˜ì „ëµë³¸ë¶€ì¥">ê²½ì˜ì „ëµë³¸ë¶€ì¥</option>
                            <option value="ë³µì§€ê²½ì œë³¸ë¶€ì¥">ë³µì§€ê²½ì œë³¸ë¶€ì¥</option>
                            <option value="ë¬¸í™”ì²´ìœ¡ë³¸ë¶€ì¥">ë¬¸í™”ì²´ìœ¡ë³¸ë¶€ì¥</option>
                            <option value="ë„ë¡œê´€ë¦¬ë³¸ë¶€ì¥">ë„ë¡œê´€ë¦¬ë³¸ë¶€ì¥</option>
                            <option value="ì‹œì„¤ì•ˆì „ë³¸ë¶€ì¥">ì‹œì„¤ì•ˆì „ë³¸ë¶€ì¥</option>
                            <option value="êµí†µì‚¬ì—…ë³¸ë¶€ì¥">êµí†µì‚¬ì—…ë³¸ë¶€ì¥</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="employeeNameGroup" style="display: none;">
                        <label for="evaluatorName">ì„±ëª…</label>
                        <input type="text" id="evaluatorName" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <div class="form-group" id="employeeDeptGroup" style="display: none;">
                        <label for="evaluatorDept">ì†Œì†</label>
                        <select id="evaluatorDept">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="startEvaluation()">í‰ê°€ ì‹œì‘</button>
                </div>
                
                <div id="evaluationArea" class="hidden">
                    <div class="evaluation-header">
                        <h2 id="currentDeptName"></h2>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    
                    <div class="evaluation-form">
                        <div class="evaluation-item">
                            <label>ì°½ì˜ì„± (18~30ì )</label>
                            <input type="number" id="creativity" min="18" max="30" placeholder="18~30" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        <div class="evaluation-item">
                            <label>ë‚œì´ë„ (18~30ì )</label>
                            <input type="number" id="difficulty" min="18" max="30" placeholder="18~30" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        <div class="evaluation-item">
                            <label>íš¨ê³¼ì„± (12~20ì )</label>
                            <input type="number" id="effectiveness" min="12" max="20" placeholder="12~20" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        <div class="evaluation-item">
                            <label>ì „íŒŒì„± (6~10ì )</label>
                            <input type="number" id="spreadability" min="6" max="10" placeholder="6~10" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        <div class="evaluation-item">
                            <label>ê¸°ì—¬ë„ (6~10ì )</label>
                            <input type="number" id="contribution" min="6" max="10" placeholder="6~10" oninput="this.value = this.value.replace(/[^0-9]/g, '');" onpaste="return false;" ondrop="return false;">
                        </div>
                        <div class="evaluation-item">
                            <label>ì´ì </label>
                            <input type="text" id="totalScore" readonly placeholder="ì´ì ">
                        </div>
                    </div>
                    
                    <div class="pagination">
                        <button class="btn btn-primary" onclick="previousEvaluation()" id="prevBtn">ì´ì „</button>
                        <span id="pageInfo">1 / 8</span>
                        <button class="btn btn-primary" onclick="nextEvaluation()" id="nextBtn">ë‹¤ìŒ</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="showPreview()" id="submitBtn" style="display: none;">í‰ê°€ ì™„ë£Œ</button>
                    </div>
                </div>
                
                <div id="previewArea" class="hidden">
                    <div class="evaluation-header">
                        <h2>ğŸ“‹ í‰ê°€ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h2>
                        <p>ì œì¶œí•˜ê¸° ì „ì— í‰ê°€ ë‚´ìš©ì„ ìµœì¢… í™•ì¸í•´ì£¼ì„¸ìš”</p>
                    </div>
                    <div id="previewContent" class="evaluation-form"></div>
                    <div class="pagination">
                        <button class="btn btn-primary" onclick="returnToEvaluation()">ìˆ˜ì •í•˜ê¸°</button>
                        <button class="btn btn-success" onclick="finalSubmission()">ìµœì¢… ì œì¶œ</button>
                    </div>
                </div>
                
                <div id="thankYouArea" class="hidden">
                    <div style="display: flex; align-items: center; justify-content: center; min-height: 50vh; flex-direction: column;">
                        <h1 style="font-size: 2.5em; color: #28a745; text-align: center;">í‰ê°€ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!</h1>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-warning" onclick="showSection('finalVote')">ìµœì¢… ëŒ€ìƒ íˆ¬í‘œí•˜ëŸ¬ ê°€ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ìµœì¢… ëŒ€ìƒ íˆ¬í‘œ -->
            <div id="finalVote" class="section">
                <div class="evaluation-header" style="background: linear-gradient(135deg, #FFD700, #FFA500);">
                    <h2>ğŸ† 2025 ì„œì‹œê³µ ì–´ì›Œë“œ ìµœì¢… ëŒ€ìƒ íˆ¬í‘œ ğŸ†</h2>
                    <p>ìƒë°˜ê¸° ìµœìš°ìˆ˜ì‘ vs í•˜ë°˜ê¸° ìµœìš°ìˆ˜ì‘</p>
                </div>

                <div id="finalVoteLogin" class="evaluation-form hidden">
                    <h3>íˆ¬í‘œë¥¼ ìœ„í•´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h3>
                    <p style="margin-bottom: 20px; color: #666;">í‰ê°€ ì°¸ì—¬ ì‹œ ì…ë ¥í–ˆë˜ ì •ë³´ë¥¼ ë™ì¼í•˜ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                    <button class="btn btn-primary" onclick="showSection('evaluator')">ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™</button>
                </div>

                <div id="finalVoteArea" class="hidden">
                    <div class="alert alert-info" style="text-align: center;">
                        ê°€ì¥ ìš°ìˆ˜í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” <strong>í•˜ë‚˜ì˜ ê³¼ì œ</strong>ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.<br>
                        ì„ì› ë° ì§ì› ëª¨ë‘ <strong>1ì¸ 1í‘œ</strong>ë¡œ ë™ì¼í•˜ê²Œ ì§‘ê³„ë©ë‹ˆë‹¤.<br>
                        <span style="color: #dc3545; font-size: 0.9em;">* í›„ë³´ ê³¼ì œ ê´€ë ¨ ë¶€ì„œ ë° ë‹´ë‹¹ ì„ì›ì€ íˆ¬í‘œê°€ ì œí•œë©ë‹ˆë‹¤.</span>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                        <div class="vote-card" onclick="submitFinalVote('firstHalf')">
                            <h3>ìƒë°˜ê¸° 1ìœ„</h3>
                            <p id="firstHalfCandidateName">ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›</p>
                            <div style="margin-top: 20px; font-size: 4em;">ğŸ¥‡</div>
                        </div>
                        <div class="vote-card" onclick="submitFinalVote('secondHalf')">
                            <h3>í•˜ë°˜ê¸° 1ìœ„</h3>
                            <p id="secondHalfCandidateName">ë¯¸ì •</p>
                            <div style="margin-top: 20px; font-size: 4em;">ğŸ¥‡</div>
                        </div>
                    </div>
                </div>

                <div id="finalVoteThankYou" class="hidden">
                    <div style="display: flex; align-items: center; justify-content: center; min-height: 50vh; flex-direction: column;">
                        <h1 style="font-size: 2.5em; color: #28a745; margin-bottom: 20px;">íˆ¬í‘œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h1>
                        <p style="font-size: 1.2em; color: #666;">ê²°ê³¼ ë°œí‘œë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                    </div>
                </div>
            </div>

            <!-- ê´€ë¦¬ì ì…ì¥ -->
            <div id="admin" class="section">
                <h2>ê´€ë¦¬ì ëª¨ë‹ˆí„°ë§</h2>
                <div class="admin-section-header"><h3>1. í•˜ë°˜ê¸° ìš°ìˆ˜ê³¼ì œ í‰ê°€ ê´€ë¦¬</h3></div>
                
                <div class="form-group" style="display:flex; flex-wrap:wrap; gap:5px;">
                    <button class="btn btn-primary" onclick="refreshStatus()">ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-success" onclick="exportEvaluationResults()">ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-danger" onclick="showDeleteEvaluationData()">ë°ì´í„° ì‚­ì œ</button>
                    <button class="btn btn-danger" onclick="resetEvaluationData()">ì „ì²´ ì´ˆê¸°í™”</button>
                </div>
                
                <div id="deleteEvaluationSection" class="hidden" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="margin-bottom: 15px;">ê°œë³„ í‰ê°€ ë°ì´í„° ì‚­ì œ</h4>
                    <div class="form-group">
                        <label for="deleteEvaluatorSelect">ì‚­ì œí•  í‰ê°€ì ì„ íƒ</label>
                        <select id="deleteEvaluatorSelect" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;"><option value="">ì„ íƒí•˜ì„¸ìš”</option></select>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="hideDeleteEvaluationData()">ì·¨ì†Œ</button>
                        <button class="btn btn-danger" onclick="deleteSelectedEvaluationData()">ì‚­ì œ</button>
                    </div>
                </div>
                
                <h4 style="margin-top:15px;">ì„ì› í‰ê°€ í˜„í™©</h4>
                <div id="executiveStatus" class="status-grid"></div>
                <h4 style="margin-top: 20px;">ì§ì› í‰ê°€ í˜„í™©</h4>
                <div id="employeeStatus" class="status-grid"></div>

                <div class="admin-section-header" style="margin-top: 50px;"><h3>2. ìµœì¢… ëŒ€ìƒ í›„ë³´ ì„¤ì •</h3></div>
                <div class="evaluation-form" style="background: #fff3cd;">
                    <div class="form-group">
                        <label>ìƒë°˜ê¸° 1ìœ„ (ê³ ì •)</label>
                        <input type="text" value="ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›" readonly disabled style="background: #e9ecef; font-weight: bold; color: #555;">
                    </div>
                    <div class="form-group">
                        <label for="adminCandidate2Select">í•˜ë°˜ê¸° 1ìœ„ ì„ íƒ (í˜„ì¥ ê²°ì •)</label>
                        <select id="adminCandidate2Select"><option value="">ì„ íƒí•˜ì„¸ìš”</option></select>
                    </div>
                    <button class="btn btn-warning" onclick="saveFinalVoteConfig()">í›„ë³´ í™•ì • ë° íˆ¬í‘œ ì‹œì‘</button>
                </div>

                <div class="admin-section-header" style="margin-top: 50px;"><h3>3. ìµœì¢… ëŒ€ìƒ íˆ¬í‘œ ê´€ë¦¬</h3></div>
                <div class="form-group" style="display:flex; flex-wrap:wrap; gap:5px;">
                    <button class="btn btn-primary" onclick="refreshStatus()">ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-success" onclick="exportFinalVoteResults()">ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-danger" onclick="showDeleteFinalVoteData()">ë°ì´í„° ì‚­ì œ</button>
                    <button class="btn btn-danger" onclick="resetFinalVoteData()">ì „ì²´ ì´ˆê¸°í™”</button>
                </div>

                <div id="deleteFinalVoteSection" class="hidden" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h4 style="margin-bottom: 15px;">ê°œë³„ ìµœì¢… íˆ¬í‘œ ë°ì´í„° ì‚­ì œ</h4>
                    <div class="form-group">
                        <label for="deleteFinalVoterSelect">ì‚­ì œí•  íˆ¬í‘œì ì„ íƒ</label>
                        <select id="deleteFinalVoterSelect" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;"><option value="">ì„ íƒí•˜ì„¸ìš”</option></select>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="hideDeleteFinalVoteData()">ì·¨ì†Œ</button>
                        <button class="btn btn-danger" onclick="deleteSelectedFinalVoteData()">ì‚­ì œ</button>
                    </div>
                </div>

                <div class="alert alert-success" style="margin-top: 20px;">
                    <h4 style="margin-bottom: 10px;">ì‹¤ì‹œê°„ íˆ¬í‘œ ì§‘ê³„</h4>
                    <div style="display: flex; justify-content: space-around; font-size: 1.2em;">
                        <span>ì´ íˆ¬í‘œìˆ˜: <strong id="totalFinalVotes">0</strong>ëª…</span>
                        <span>ìƒë°˜ê¸°: <strong id="firstHalfVotes">0</strong>í‘œ</span>
                        <span>í•˜ë°˜ê¸°: <strong id="secondHalfVotes">0</strong>í‘œ</span>
                    </div>
                </div>
                <h4 style="margin-top:15px;">ì„ì› íˆ¬í‘œ í˜„í™©</h4>
                <div id="finalVoteExecutiveStatus" class="status-grid"></div>
                <h4 style="margin-top: 20px;">ì§ì› íˆ¬í‘œ í˜„í™©</h4>
                <div id="finalVoteEmployeeStatus" class="status-grid"></div>
            </div>
            
            <!-- ê²°ê³¼ í™•ì¸ -->
            <div id="results" class="section">
                <h2>í‰ê°€ ê²°ê³¼</h2>
                <div class="form-group">
                    <button class="btn btn-success" onclick="showFinalRanking()">í•˜ë°˜ê¸° ìµœì¢… ìˆœìœ„</button>
                    <button class="btn btn-primary" onclick="calculateResults()">í•˜ë°˜ê¸° ê²°ê³¼ ê³„ì‚°</button>
                </div>
                <div id="resultsArea" class="results-grid">
                    <div style="display: flex; align-items: center; justify-content: center; min-height: 40vh; text-align: center;">
                        <div>
                            <h3 style="color: #666; margin-bottom: 20px;">ğŸ“Š í‰ê°€ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì‹œë ¤ë©´</h3>
                            <p style="font-size: 1.2em; color: #999;">ìœ„ì˜ 'ê²°ê³¼ ê³„ì‚°' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
                 <div style="margin-top: 50px; border-top: 3px solid #FFD700; padding-top: 30px;">
                    <h2 style="text-align: center; color: #d4af37; margin-bottom: 20px;">ğŸ‘‘ 2025 ì„œì‹œê³µ ì–´ì›Œë“œ ìµœì¢… ëŒ€ìƒ ğŸ‘‘</h2>
                    <div id="finalGrandPrizeArea" style="text-align: center;">
                        <button class="btn btn-warning" style="background: #FFD700; color: #333; font-size: 1.2em; padding: 15px 40px;" onclick="revealGrandPrize()">ìµœì¢… ëŒ€ìƒ ë°œí‘œ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ ëª¨ë‹¬ -->
    <div id="customModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">ì•Œë¦¼</h3>
            <div id="modalMessage"></div>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="modalConfirm">í™•ì¸</button>
                <button class="btn btn-danger" id="modalCancel" style="display: none;">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, onSnapshot, setDoc, getDoc, addDoc, getDocs, writeBatch, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Variables
        let currentEvaluator = null;
        let currentPage = 0;
        let evaluations = [];
        let allEvaluations = []; // Fetched from Firestore
        let completedEvaluators = []; // Derived from allEvaluations
        let finalVotes = []; // Fetched from Firestore
        let finalVoters = []; // Derived from finalVotes
        let finalVoteConfig = { candidate1: 'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›', candidate2: '' };
        let isAdminMode = false;
        let isAdminAuthenticated = false;
        const ADMIN_PASSWORD = 'sisul2025';
        
        // Admin Trigger
        let headerClickCount = 0;
        let headerClickTimer;

        // Firebase Setup
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Firestore Paths (Using Collections for Multi-user Safety)
        const EVAL_COLL_NAME = 'evaluations';
        const VOTE_COLL_NAME = 'final_votes';
        const CONFIG_COLL_NAME = 'config';
        const CONFIG_DOC_ID = 'main';

        // Data Setup
        const citizenScores = {
             'ITì „ëµì‹¤': 85, 'ì¥ì• ì¸ì½œíƒì‹œìš´ì˜ì²˜': 92, 'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›': 88, 'ì²­ê³„ì²œê´€ë¦¬ì²˜': 90,
             'ìì‚°ê´€ë¦¬í˜ì‹ ì²˜': 82, 'ê³µì‚¬ê°ë…1ì²˜': 85, 'ì£¼ì°¨ì‹œì„¤ìš´ì˜ì²˜': 89, 'ê³µê³µìì „ê±°ìš´ì˜ì²˜': 95
        };
        const departments = ['ITì „ëµì‹¤', 'ì¥ì• ì¸ì½œíƒì‹œìš´ì˜ì²˜', 'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›', 'ì²­ê³„ì²œê´€ë¦¬ì²˜', 'ìì‚°ê´€ë¦¬í˜ì‹ ì²˜', 'ê³µì‚¬ê°ë…1ì²˜', 'ì£¼ì°¨ì‹œì„¤ìš´ì˜ì²˜', 'ê³µê³µìì „ê±°ìš´ì˜ì²˜'];
        const allDepartments = [
            'ê°ì‚¬ì‹¤', 'ì•ˆì „ì²˜', 'ê¸°íšì¡°ì •ì‹¤', 'ì¸ì‚¬ë…¸ë¬´ì²˜', 'ì´ë¬´ì²˜', 'í™ë³´ì‹¤', 'ì¸ì¬ë¬¸í™”ì›', 'ITì „ëµì‹¤',
            'ìƒê°€ìš´ì˜ì²˜', 'ì¶”ëª¨ì‹œì„¤ìš´ì˜ì²˜', 'ì¥ì• ì¸ì½œíƒì‹œìš´ì˜ì²˜', 'ì„œìš¸ì›”ë“œì»µê²½ê¸°ì¥ìš´ì˜ì²˜', 'ë”ê²½ê¸°ì¥ìš´ì˜ì²˜', 
            'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›', 'ì²­ê³„ì²œê´€ë¦¬ì²˜', 'ë‚¨ì‚°ê³¤ëŒë¼ì¸ìˆ˜ë‹¨TF', 'ìì‚°ê´€ë¦¬í˜ì‹ ì²˜', 'ë„ë¡œê´€ë¦¬ì²˜', 
            'ë„ë¡œì‹œì„¤ì²˜', 'ë„ë¡œê¸°ì „ì²˜', 'ë„ë¡œí™˜ê²½ì²˜', 'êµí†µì •ë³´ì²˜', 'ê³µì‚¬ê°ë…1ì²˜', 'ê³µì‚¬ê°ë…2ì²˜', 
            'ê³µì‚¬ê°ë…3ì²˜', 'ê³µë™êµ¬ê´€ë¦¬ì²˜', 'ìƒìˆ˜ë„ì§€ì›ì²˜', 'ì£¼ì°¨ì‹œì„¤ìš´ì˜ì²˜', 'êµí†µì‹œì„¤ìš´ì˜ì²˜', 'ê³µê³µìì „ê±°ìš´ì˜ì²˜'
        ];
        const executives = [
            { name: 'ì´ì‚¬ì¥', dept: 'ì´ì‚¬ì¥', cannotEvaluate: [] },
            { name: 'ê²½ì˜ì „ëµë³¸ë¶€ì¥', dept: 'ê²½ì˜ì „ëµë³¸ë¶€', cannotEvaluate: ['ê¸°íšì¡°ì •ì‹¤', 'ì¸ì‚¬ë…¸ë¬´ì²˜', 'ì´ë¬´ì²˜', 'í™ë³´ì‹¤', 'ì¸ì¬ë¬¸í™”ì›', 'ITì „ëµì‹¤'] },
            { name: 'ë³µì§€ê²½ì œë³¸ë¶€ì¥', dept: 'ë³µì§€ê²½ì œë³¸ë¶€', cannotEvaluate: ['ìƒê°€ìš´ì˜ì²˜', 'ì¶”ëª¨ì‹œì„¤ìš´ì˜ì²˜', 'ì¥ì• ì¸ì½œíƒì‹œìš´ì˜ì²˜'] },
            { name: 'ë¬¸í™”ì²´ìœ¡ë³¸ë¶€ì¥', dept: 'ë¬¸í™”ì²´ìœ¡ë³¸ë¶€', cannotEvaluate: ['ì„œìš¸ì›”ë“œì»µê²½ê¸°ì¥ìš´ì˜ì²˜', 'ë”ê²½ê¸°ì¥ìš´ì˜ì²˜', 'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›', 'ì²­ê³„ì²œê´€ë¦¬ì²˜', 'ë‚¨ì‚°ê³¤ëŒë¼ì¸ìˆ˜ë‹¨TF'] },
            { name: 'ë„ë¡œê´€ë¦¬ë³¸ë¶€ì¥', dept: 'ë„ë¡œê´€ë¦¬ë³¸ë¶€', cannotEvaluate: ['ìì‚°ê´€ë¦¬í˜ì‹ ì²˜', 'ë„ë¡œê´€ë¦¬ì²˜', 'ë„ë¡œì‹œì„¤ì²˜', 'ë„ë¡œê¸°ì „ì²˜', 'ë„ë¡œí™˜ê²½ì²˜', 'êµí†µì •ë³´ì²˜'] },
            { name: 'ì‹œì„¤ì•ˆì „ë³¸ë¶€ì¥', dept: 'ì‹œì„¤ì•ˆì „ë³¸ë¶€', cannotEvaluate: ['ê³µì‚¬ê°ë…1ì²˜', 'ê³µì‚¬ê°ë…2ì²˜', 'ê³µì‚¬ê°ë…3ì²˜', 'ê³µë™êµ¬ê´€ë¦¬ì²˜', 'ìƒìˆ˜ë„ì§€ì›ì²˜'] },
            { name: 'êµí†µì‚¬ì—…ë³¸ë¶€ì¥', dept: 'êµí†µì‚¬ì—…ë³¸ë¶€', cannotEvaluate: ['ì£¼ì°¨ì‹œì„¤ìš´ì˜ì²˜', 'êµí†µì‹œì„¤ìš´ì˜ì²˜', 'ê³µê³µìì „ê±°ìš´ì˜ì²˜'] }
        ];

        // --- Init & Listeners ---
        async function init() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                
                // 1. Listen to Evaluations Collection
                onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', EVAL_COLL_NAME), (snapshot) => {
                    const loading = document.getElementById('loadingOverlay');
                    if(loading) loading.style.display = 'none';
                    if (!isAdminMode) document.getElementById('evaluator').classList.remove('hidden');
                    
                    allEvaluations = [];
                    completedEvaluators = [];
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        allEvaluations.push(data);
                        // Derive completed evaluators key
                        const key = data.evaluator.type === 'executive' ? 
                            data.evaluator.dept : `${data.evaluator.name}_${data.evaluator.dept}`;
                        completedEvaluators.push(key);
                    });
                    
                    if (isAdminMode) window.refreshStatus();
                }, (error) => console.error("Eval Listener Error", error));

                // 2. Listen to Final Votes Collection
                onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', VOTE_COLL_NAME), (snapshot) => {
                    finalVotes = [];
                    finalVoters = [];
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        finalVotes.push(data);
                        // Derive final voter key
                        const key = data.voter.type === 'executive' ? 
                            data.voter.dept : `${data.voter.name}_${data.voter.dept}`;
                        finalVoters.push(key);
                    });
                    
                    if (isAdminMode) window.refreshStatus();
                }, (error) => console.error("Vote Listener Error", error));

                // 3. Listen to Config
                onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', CONFIG_COLL_NAME, CONFIG_DOC_ID), (docSnap) => {
                    if (docSnap.exists()) {
                        finalVoteConfig = docSnap.data();
                        const c1Name = document.getElementById('firstHalfCandidateName');
                        const c2Name = document.getElementById('secondHalfCandidateName');
                        if(c1Name) c1Name.textContent = finalVoteConfig.candidate1 || 'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›';
                        if(c2Name) c2Name.textContent = finalVoteConfig.candidate2 || 'ë¯¸ì •';
                    }
                }, (error) => console.error("Config Listener Error", error));

                // Populate Admin Select
                const adminSelect = document.getElementById('adminCandidate2Select');
                if (adminSelect) {
                    allDepartments.forEach(dept => {
                        const option = document.createElement('option');
                        option.value = dept;
                        option.textContent = dept;
                        adminSelect.appendChild(option);
                    });
                }

            } catch (err) {
                console.error("Auth Error:", err);
                alert("ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

        // --- Helper Functions Attached to Window ---
        window.showAlert = function(message) {
            return new Promise((resolve) => {
                document.getElementById('modalTitle').textContent = 'ì•Œë¦¼';
                document.getElementById('modalMessage').innerHTML = message;
                document.getElementById('modalConfirm').textContent = 'í™•ì¸';
                document.getElementById('modalCancel').style.display = 'none';
                document.getElementById('customModal').style.display = 'block';
                document.getElementById('modalConfirm').onclick = () => {
                    document.getElementById('customModal').style.display = 'none';
                    resolve(true);
                };
            });
        };

        window.showConfirm = function(message) {
            return new Promise((resolve) => {
                document.getElementById('modalTitle').textContent = 'í™•ì¸';
                document.getElementById('modalMessage').textContent = message;
                document.getElementById('modalConfirm').textContent = 'í™•ì¸';
                document.getElementById('modalCancel').style.display = 'inline-block';
                document.getElementById('customModal').style.display = 'block';
                document.getElementById('modalConfirm').onclick = () => {
                    document.getElementById('customModal').style.display = 'none';
                    resolve(true);
                };
                document.getElementById('modalCancel').onclick = () => {
                    document.getElementById('customModal').style.display = 'none';
                    resolve(false);
                };
            });
        };

        window.showPasswordPrompt = function() {
            return new Promise((resolve) => {
                document.getElementById('modalTitle').textContent = 'ê´€ë¦¬ì ì¸ì¦';
                document.getElementById('modalMessage').innerHTML = `<p style="margin-bottom: 15px;">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</p><input type="password" id="adminPasswordInput" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 5px; font-size: 1em;" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">`;
                document.getElementById('modalConfirm').textContent = 'í™•ì¸';
                document.getElementById('modalCancel').style.display = 'inline-block';
                document.getElementById('customModal').style.display = 'block';
                setTimeout(() => document.getElementById('adminPasswordInput').focus(), 100);
                document.getElementById('adminPasswordInput').onkeypress = (e) => { if (e.key === 'Enter') document.getElementById('modalConfirm').click(); };
                document.getElementById('modalConfirm').onclick = () => {
                    const password = document.getElementById('adminPasswordInput').value;
                    document.getElementById('customModal').style.display = 'none';
                    resolve(password);
                };
                document.getElementById('modalCancel').onclick = () => {
                    document.getElementById('customModal').style.display = 'none';
                    resolve(null);
                };
            });
        };

        window.showSection = function(sectionName) {
            if (!isAdminMode && (sectionName === 'admin' || sectionName === 'results')) {
                window.showAlert('ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìƒë‹¨ ì œëª©ì„ 5ë²ˆ í´ë¦­í•˜ì—¬ ì¸ì¦í•˜ì„¸ìš”.');
                return;
            }
            if (isAdminMode && (sectionName === 'admin' || sectionName === 'results') && !isAdminAuthenticated) {
                window.authenticateAdmin(sectionName);
                return;
            }
            if (sectionName === 'evaluator') window.resetEvaluatorForm();
            if (sectionName === 'results') window.resetResultsArea();

            if (sectionName === 'finalVote') {
                if (!currentEvaluator) {
                    document.getElementById('finalVoteLogin').classList.remove('hidden');
                    document.getElementById('finalVoteArea').classList.add('hidden');
                    document.getElementById('finalVoteThankYou').classList.add('hidden');
                } else {
                    const evaluatorKey = currentEvaluator.type === 'executive' ? currentEvaluator.dept : `${currentEvaluator.name}_${currentEvaluator.dept}`;
                    if (finalVoters.includes(evaluatorKey)) {
                        document.getElementById('finalVoteLogin').classList.add('hidden');
                        document.getElementById('finalVoteArea').classList.add('hidden');
                        document.getElementById('finalVoteThankYou').classList.remove('hidden');
                    } else {
                        document.getElementById('finalVoteLogin').classList.add('hidden');
                        document.getElementById('finalVoteArea').classList.remove('hidden');
                        document.getElementById('finalVoteThankYou').classList.add('hidden');
                    }
                }
            }
            
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            const targetSection = document.getElementById(sectionName);
            targetSection.classList.remove('hidden');
            targetSection.classList.add('active');
            event.target.classList.add('active');
            
            if (sectionName === 'admin') window.refreshStatus();
        };

        window.authenticateAdmin = async function(targetSection) {
            const password = await window.showPasswordPrompt();
            if (password === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                window.showAlert('ê´€ë¦¬ì ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.showSection(targetSection);
            } else if (password !== null) {
                window.showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                window.showSection('evaluator');
            } else {
                window.showSection('evaluator');
            }
        };

        window.resetResultsArea = function() {
            document.getElementById('resultsArea').innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; min-height: 40vh; text-align: center;">
                    <div><h3 style="color: #666; margin-bottom: 20px;">ğŸ“Š í‰ê°€ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì‹œë ¤ë©´</h3><p style="font-size: 1.2em; color: #999;">ìœ„ì˜ 'ê²°ê³¼ ê³„ì‚°' ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.</p></div>
                </div>
            `;
            document.getElementById('finalGrandPrizeArea').innerHTML = `<button class="btn btn-warning" style="background: #FFD700; color: #333; font-size: 1.2em; padding: 15px 40px;" onclick="revealGrandPrize()">ìµœì¢… ëŒ€ìƒ ë°œí‘œ</button>`;
        };

        // --- Logic Functions ---
        window.updateDepartmentOptions = function() {
            const type = document.getElementById('evaluatorType').value;
            const executiveNameGroup = document.getElementById('executiveNameGroup');
            const employeeNameGroup = document.getElementById('employeeNameGroup');
            const employeeDeptGroup = document.getElementById('employeeDeptGroup');
            const deptSelect = document.getElementById('evaluatorDept');
            
            executiveNameGroup.style.display = 'none';
            employeeNameGroup.style.display = 'none';
            employeeDeptGroup.style.display = 'none';
            deptSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            document.getElementById('evaluatorPosition').value = '';
            document.getElementById('evaluatorName').value = '';
            
            if (type === 'executive') executiveNameGroup.style.display = 'block';
            else if (type === 'employee') {
                employeeNameGroup.style.display = 'block';
                employeeDeptGroup.style.display = 'block';
                allDepartments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept; option.textContent = dept; deptSelect.appendChild(option);
                });
            }
        };

        window.startEvaluation = function() {
            const type = document.getElementById('evaluatorType').value;
            let name, dept;
            
            if (type === 'executive') {
                dept = document.getElementById('evaluatorPosition').value;
                name = dept;
                if (!dept) return window.showAlert('ì§ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            } else if (type === 'employee') {
                name = document.getElementById('evaluatorName').value;
                dept = document.getElementById('evaluatorDept').value;
                if (!name || !dept) return window.showAlert('ì„±ëª…ê³¼ ì†Œì†ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            } else {
                return window.showAlert('í‰ê°€ì êµ¬ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            }
            
            currentEvaluator = { type, name, dept };
            let targetDepartments = [...departments];
            
            if (type === 'executive') {
                const executive = executives.find(e => e.name === dept);
                if (executive) targetDepartments = targetDepartments.filter(d => !executive.cannotEvaluate.includes(d));
            } else {
                targetDepartments = targetDepartments.filter(d => d !== dept);
            }
            
            evaluations = targetDepartments.map(dept => ({ department: dept, creativity: '', difficulty: '', effectiveness: '', spreadability: '', contribution: '', total: 0 }));
            currentPage = 0;
            
            document.getElementById('evaluatorLogin').classList.add('hidden');
            document.getElementById('evaluationArea').classList.remove('hidden');
            window.updateEvaluationPage();
        };

        window.updateEvaluationPage = function() {
            if (evaluations.length === 0) return;
            const current = evaluations[currentPage];
            document.getElementById('currentDeptName').textContent = current.department;
            document.getElementById('creativity').value = current.creativity;
            document.getElementById('difficulty').value = current.difficulty;
            document.getElementById('effectiveness').value = current.effectiveness;
            document.getElementById('spreadability').value = current.spreadability;
            document.getElementById('contribution').value = current.contribution;
            window.updateTotalScore();
            
            document.getElementById('pageInfo').textContent = `${currentPage + 1} / ${evaluations.length}`;
            document.getElementById('prevBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = currentPage < evaluations.length - 1 ? 'inline-block' : 'none';
            document.getElementById('submitBtn').style.display = currentPage === evaluations.length - 1 ? 'inline-block' : 'none';
            document.getElementById('progressFill').style.width = ((currentPage + 1) / evaluations.length) * 100 + '%';
        };

        window.saveCurrentEvaluation = function() {
            if (evaluations.length === 0) return;
            const current = evaluations[currentPage];
            current.creativity = parseInt(document.getElementById('creativity').value) || 0;
            current.difficulty = parseInt(document.getElementById('difficulty').value) || 0;
            current.effectiveness = parseInt(document.getElementById('effectiveness').value) || 0;
            current.spreadability = parseInt(document.getElementById('spreadability').value) || 0;
            current.contribution = parseInt(document.getElementById('contribution').value) || 0;
            current.total = current.creativity + current.difficulty + current.effectiveness + current.spreadability + current.contribution;
        };

        window.updateTotalScore = function() {
            window.saveCurrentEvaluation();
            const current = evaluations[currentPage];
            const totalEl = document.getElementById('totalScore');
            totalEl.value = current.total > 0 ? current.total : '';
            totalEl.style.color = current.total > 100 ? 'red' : '';
        };

        window.validateScore = function(input, min, max) {
            const value = parseInt(input.value);
            if (input.value !== '' && (isNaN(value) || value < min || value > max)) {
                input.style.borderColor = 'red'; input.style.backgroundColor = '#ffe6e6'; return false;
            } else {
                input.style.borderColor = '#e9ecef'; input.style.backgroundColor = ''; return true;
            }
        };

        window.validateAllScores = function() {
            const current = evaluations[currentPage];
            if (!current.creativity || !current.difficulty || !current.effectiveness || !current.spreadability || !current.contribution) {
                window.showAlert('ëª¨ë“  í•­ëª©ì— ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return false;
            }
            if (current.total > 100) { window.showAlert('ì´ì ì´ 100ì ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return false; }
            return true;
        };

        window.previousEvaluation = function() {
            if (currentPage > 0) { window.saveCurrentEvaluation(); currentPage--; window.updateEvaluationPage(); }
            else { document.getElementById('evaluationArea').classList.add('hidden'); document.getElementById('evaluatorLogin').classList.remove('hidden'); }
        };

        window.nextEvaluation = function() {
            if (currentPage < evaluations.length - 1) {
                if (!window.validateAllScores()) return;
                window.saveCurrentEvaluation(); currentPage++; window.updateEvaluationPage();
            }
        };

        window.showPreview = function() {
            if (!window.validateAllScores()) return;
            window.saveCurrentEvaluation();
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = `
                <div class="evaluation-item" style="background-color: #e3f2fd; margin-bottom: 20px;">
                    <div style="width: 100%;">
                        <h4 style="margin-bottom: 10px; color: #1976d2;">í‰ê°€ì ì •ë³´</h4>
                        <p><strong>êµ¬ë¶„:</strong> ${currentEvaluator.type === 'executive' ? 'ì„ì›' : 'ì§ì›'}</p>
                        <p><strong>ì„±ëª…/ì§ìœ„:</strong> ${currentEvaluator.name}</p>
                        ${currentEvaluator.type === 'employee' ? `<p><strong>ì†Œì†:</strong> ${currentEvaluator.dept}</p>` : ''}
                    </div>
                </div>`;
            evaluations.forEach((evaluation, index) => {
                previewContent.innerHTML += `
                    <div class="evaluation-item" style="flex-direction: column; align-items: flex-start;">
                        <h4 style="margin-bottom: 15px; color: #333;">${index + 1}. ${evaluation.department}</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%;">
                            <div>ì´ì : <strong style="color:#28a745;">${evaluation.total}ì </strong></div>
                        </div>
                    </div>`;
            });
            document.getElementById('evaluationArea').classList.add('hidden');
            document.getElementById('previewArea').classList.remove('hidden');
        };

        window.returnToEvaluation = function() {
            document.getElementById('previewArea').classList.add('hidden');
            document.getElementById('evaluationArea').classList.remove('hidden');
            currentPage = evaluations.length - 1;
            window.updateEvaluationPage();
        };

        window.finalSubmission = async function() {
            const evaluationData = {
                evaluator: currentEvaluator,
                evaluations: evaluations,
                timestamp: new Date().toISOString()
            };
            const docId = currentEvaluator.type === 'executive' ? currentEvaluator.dept : `${currentEvaluator.name}_${currentEvaluator.dept}`;
            
            try {
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', EVAL_COLL_NAME, docId), evaluationData);
                document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                document.getElementById('thankYouScreen').classList.add('active');
                currentPage = 0; evaluations = [];
            } catch (e) {
                console.error(e);
                window.showAlert("ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        };

        window.resetEvaluatorForm = function() {
            document.getElementById('evaluatorType').value = '';
            document.getElementById('evaluatorPosition').value = '';
            document.getElementById('evaluatorName').value = '';
            document.getElementById('evaluatorDept').value = '';
            window.updateDepartmentOptions();
            document.getElementById('evaluationArea').classList.add('hidden');
            document.getElementById('previewArea').classList.add('hidden');
            document.getElementById('thankYouArea').classList.add('hidden');
            document.getElementById('evaluatorLogin').classList.remove('hidden');
        };

        // --- Admin Functions ---
        window.refreshStatus = function() {
            window.updateExecutiveStatus();
            window.updateEmployeeStatus();
            window.updateFinalVoteExecutiveStatus();
            window.updateFinalVoteEmployeeStatus();
            window.updateFinalVoteStats();
        };

        window.updateExecutiveStatus = function() {
            const container = document.getElementById('executiveStatus');
            container.innerHTML = '';
            executives.forEach(exec => {
                const completed = allEvaluations.some(e => e.evaluator.type === 'executive' && e.evaluator.dept === exec.name);
                container.innerHTML += `<div class="status-card ${completed ? 'status-complete' : 'status-incomplete'}"><div>${exec.name}</div><div>${completed ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}</div></div>`;
            });
        };

        window.updateEmployeeStatus = function() {
            const container = document.getElementById('employeeStatus');
            container.innerHTML = '';
            allDepartments.forEach(dept => {
                const count = allEvaluations.filter(e => e.evaluator.type === 'employee' && e.evaluator.dept === dept).length;
                container.innerHTML += `<div class="status-card ${count >= 2 ? 'status-complete' : 'status-incomplete'}"><div>${dept}</div><div>${count}/2 ì™„ë£Œ</div></div>`;
            });
        };

        window.exportEvaluationResults = function() {
            if (allEvaluations.length === 0) return window.showAlert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            let csv = "í‰ê°€ìêµ¬ë¶„,í‰ê°€ìëª…,í‰ê°€ìì†Œì†,í‰ê°€ë¶€ì„œ,ì°½ì˜ì„±,ë‚œì´ë„,íš¨ê³¼ì„±,ì „íŒŒì„±,ê¸°ì—¬ë„,ì´ì \n";
            allEvaluations.forEach(d => {
                d.evaluations.forEach(e => {
                    csv += `${d.evaluator.type === 'executive'?'ì„ì›':'ì§ì›'},${d.evaluator.name},${d.evaluator.dept},${e.department},${e.creativity},${e.difficulty},${e.effectiveness},${e.spreadability},${e.contribution},${e.total}\n`;
                });
            });
            window.downloadCSV(csv, 'í‰ê°€ê²°ê³¼.csv');
        };

        window.resetEvaluationData = async function() {
            if (await window.showConfirm('í•˜ë°˜ê¸° ìš°ìˆ˜ê³¼ì œ í‰ê°€ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // Delete all documents in collection
                const snap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', EVAL_COLL_NAME));
                const batch = writeBatch(db);
                snap.forEach(d => batch.delete(d.ref));
                await batch.commit();
                window.showAlert('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        };

        window.showDeleteEvaluationData = function() {
            const section = document.getElementById('deleteEvaluationSection');
            if(!section.classList.contains('hidden')) return window.hideDeleteEvaluationData();
            const select = document.getElementById('deleteEvaluatorSelect');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            allEvaluations.forEach((d, i) => {
                const info = d.evaluator.type === 'executive' ? d.evaluator.name : `${d.evaluator.name} (${d.evaluator.dept})`;
                const opt = document.createElement('option');
                // Use ID to identify doc
                opt.value = d.evaluator.type === 'executive' ? d.evaluator.dept : `${d.evaluator.name}_${d.evaluator.dept}`; 
                opt.textContent = `${d.evaluator.type==='executive'?'ì„ì›':'ì§ì›'} - ${info}`;
                select.appendChild(opt);
            });
            section.classList.remove('hidden');
        };

        window.hideDeleteEvaluationData = function() { document.getElementById('deleteEvaluationSection').classList.add('hidden'); };

        window.deleteSelectedEvaluationData = async function() {
            const docId = document.getElementById('deleteEvaluatorSelect').value;
            if (!docId) return window.showAlert('ì„ íƒí•´ì£¼ì„¸ìš”.');
            if (await window.showConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', EVAL_COLL_NAME, docId));
                window.showAlert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.hideDeleteEvaluationData();
            }
        };

        // --- Final Vote Admin ---
        window.saveFinalVoteConfig = function() {
            const candidate1 = 'ì„œìš¸ì–´ë¦°ì´ëŒ€ê³µì›';
            const candidate2 = document.getElementById('adminCandidate2Select').value;
            if (!candidate2) return window.showAlert('í•˜ë°˜ê¸° 1ìœ„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            if (candidate1 === candidate2) return window.showAlert('ìƒ/í•˜ë°˜ê¸° 1ìœ„ê°€ ê°™ìŠµë‹ˆë‹¤.');
            
            window.showConfirm(`í•˜ë°˜ê¸° 1ìœ„ í›„ë³´ë¥¼ '${candidate2}'ë¡œ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`).then(async res => {
                if (res) {
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', CONFIG_COLL_NAME, CONFIG_DOC_ID), { candidate1, candidate2 });
                    window.showAlert('í›„ë³´ê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            });
        };

        window.updateFinalVoteExecutiveStatus = function() {
            const container = document.getElementById('finalVoteExecutiveStatus');
            container.innerHTML = '';
            executives.forEach(exec => {
                const voted = finalVotes.some(v => v.voter.type === 'executive' && v.voter.dept === exec.name);
                container.innerHTML += `<div class="status-card ${voted ? 'status-complete' : 'status-incomplete'}"><div>${exec.name}</div><div>${voted ? 'íˆ¬í‘œì™„ë£Œ' : 'ë¯¸íˆ¬í‘œ'}</div></div>`;
            });
        };

        window.updateFinalVoteEmployeeStatus = function() {
            const container = document.getElementById('finalVoteEmployeeStatus');
            container.innerHTML = '';
            allDepartments.forEach(dept => {
                const count = finalVotes.filter(v => v.voter.type === 'employee' && v.voter.dept === dept).length;
                container.innerHTML += `<div class="status-card ${count > 0 ? 'status-complete' : 'status-incomplete'}"><div>${dept}</div><div>${count}ëª… íˆ¬í‘œ</div></div>`;
            });
        };

        window.updateFinalVoteStats = function() {
            document.getElementById('totalFinalVotes').textContent = finalVotes.length;
            document.getElementById('firstHalfVotes').textContent = finalVotes.filter(v => v.choice === 'firstHalf').length;
            document.getElementById('secondHalfVotes').textContent = finalVotes.filter(v => v.choice === 'secondHalf').length;
        };

        window.exportFinalVoteResults = function() {
            if (finalVotes.length === 0) return window.showAlert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            let csv = "êµ¬ë¶„,ì´ë¦„,ì†Œì†,ì„ íƒ\n";
            finalVotes.forEach(v => {
                csv += `${v.voter.type === 'executive'?'ì„ì›':'ì§ì›'},${v.voter.name},${v.voter.dept},${v.choice === 'firstHalf' ? 'ìƒë°˜ê¸°' : 'í•˜ë°˜ê¸°'}\n`;
            });
            window.downloadCSV(csv, 'ìµœì¢…íˆ¬í‘œê²°ê³¼.csv');
        };

        window.resetFinalVoteData = async function() {
            if (await window.showConfirm('ìµœì¢… íˆ¬í‘œ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const snap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', VOTE_COLL_NAME));
                const batch = writeBatch(db);
                snap.forEach(d => batch.delete(d.ref));
                await batch.commit();
                window.showAlert('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        };

        window.showDeleteFinalVoteData = function() {
            const section = document.getElementById('deleteFinalVoteSection');
            if(!section.classList.contains('hidden')) return window.hideDeleteFinalVoteData();
            const select = document.getElementById('deleteFinalVoterSelect');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            finalVotes.forEach(v => {
                const docId = v.voter.type === 'executive' ? v.voter.dept : `${v.voter.name}_${v.voter.dept}`;
                const info = v.voter.type === 'executive' ? v.voter.name : `${v.voter.name} (${v.voter.dept})`;
                const opt = document.createElement('option');
                opt.value = docId; opt.textContent = info; select.appendChild(opt);
            });
            section.classList.remove('hidden');
        };

        window.hideDeleteFinalVoteData = function() { document.getElementById('deleteFinalVoteSection').classList.add('hidden'); };

        window.deleteSelectedFinalVoteData = async function() {
            const docId = document.getElementById('deleteFinalVoterSelect').value;
            if (!docId) return window.showAlert('ì„ íƒí•´ì£¼ì„¸ìš”.');
            if (await window.showConfirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', VOTE_COLL_NAME, docId));
                window.showAlert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.hideDeleteFinalVoteData();
            }
        };

        // --- Final Vote Logic ---
        window.submitFinalVote = async function(choice) {
            if (!currentEvaluator) return window.showAlert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            if (!finalVoteConfig.candidate2) return window.showAlert('í•˜ë°˜ê¸° í›„ë³´ê°€ ì•„ì§ í™•ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');

            const c1 = finalVoteConfig.candidate1; 
            const c2 = finalVoteConfig.candidate2;

            // Restrictions
            if (currentEvaluator.type === 'executive') {
                const exec = executives.find(e => e.name === currentEvaluator.name);
                if (exec && (exec.cannotEvaluate.includes(c1) || exec.cannotEvaluate.includes(c2))) {
                    return window.showAlert('ê´€ê³„ëœ ë¶€ì„œê°€ í›„ë³´ì´ë¯€ë¡œ íˆ¬í‘œí•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } else {
                if (currentEvaluator.dept === c1 || currentEvaluator.dept === c2) {
                    return window.showAlert('ì†Œì† ë¶€ì„œê°€ í›„ë³´ì´ë¯€ë¡œ íˆ¬í‘œí•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }

            const docId = currentEvaluator.type === 'executive' ? currentEvaluator.dept : `${currentEvaluator.name}_${currentEvaluator.dept}`;
            
            if (finalVoters.includes(docId)) return window.showAlert('ì´ë¯¸ íˆ¬í‘œí•˜ì…¨ìŠµë‹ˆë‹¤.');

            const candName = choice === 'firstHalf' ? c1 : c2;
            if (await window.showConfirm(`'${candName}'ì— íˆ¬í‘œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                try {
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', VOTE_COLL_NAME, docId), {
                        choice: choice, voter: currentEvaluator, timestamp: new Date().toISOString()
                    });
                    document.getElementById('finalVoteArea').classList.add('hidden');
                    document.getElementById('finalVoteThankYou').classList.remove('hidden');
                } catch(e) {
                    console.error(e);
                    window.showAlert("íˆ¬í‘œ ì €ì¥ ì‹¤íŒ¨");
                }
            }
        };

        window.downloadCSV = function(csvContent, fileName) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // --- Init ---
        init();

        // Admin Toggle
        document.getElementById('headerTitle').addEventListener('click', () => {
            clearTimeout(headerClickTimer);
            headerClickCount++;
            if (headerClickCount >= 5) {
                isAdminMode = true; headerClickCount = 0;
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'inline-block');
                window.showAlert("ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
                window.refreshStatus();
            } else {
                headerClickTimer = setTimeout(() => { headerClickCount = 0; }, 1000);
            }
        });

        // Event Listeners for inputs
        ['creativity', 'difficulty', 'effectiveness', 'spreadability', 'contribution'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                window.validateScore(this, 
                    (id==='creativity'||id==='difficulty')?18:(id==='effectiveness'?12:6), 
                    (id==='creativity'||id==='difficulty')?30:(id==='effectiveness'?20:10));
                window.saveCurrentEvaluation();
                window.updateTotalScore();
            });
        });
        document.getElementById('evaluatorType').addEventListener('change', window.updateDepartmentOptions);

        window.calculateResults = function() {
            const results = {};
            departments.forEach(dept => {
                results[dept] = { department: dept, executiveScores: [], employeeScores: [], executiveAvg: 0, employeeAvg: 0, finalScore: 0 };
            });
            allEvaluations.forEach(d => {
                d.evaluations.forEach(e => {
                    if(results[e.department]) {
                        if(d.evaluator.type==='executive') results[e.department].executiveScores.push(e.total);
                        else results[e.department].employeeScores.push(e.total);
                    }
                });
            });
            Object.values(results).forEach(r => {
                const cScore = citizenScores[r.department] || 0;
                if(r.executiveScores.length > 0) r.executiveAvg = r.executiveScores.reduce((a,b)=>a+b,0)/r.executiveScores.length;
                if(r.employeeScores.length > 0) r.employeeAvg = r.employeeScores.reduce((a,b)=>a+b,0)/r.employeeScores.length;
                r.finalScore = (r.executiveAvg * 0.5) + (r.employeeAvg * 0.4) + (cScore * 0.1);
            });
            window.displayResults(results);
        };

        window.displayResults = function(results) {
            const container = document.getElementById('resultsArea');
            container.innerHTML = '';
            const sortedResults = Object.values(results).sort((a, b) => b.finalScore - a.finalScore);
            sortedResults.forEach((result, index) => {
                const card = document.createElement('div');
                card.className = 'result-card';
                if (index === 0) card.style.background = '#FFD700'; 
                else if (index === 1) card.style.background = '#C0C0C0'; 
                else if (index === 2) card.style.background = '#CD7F32'; 
                card.innerHTML = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h2 style="font-size: 2em; margin-bottom: 10px; ${index < 3 ? 'color: #333;' : 'color: #007bff;'}">${index + 1}ìœ„: ${result.department}</h2>
                    </div>
                    <div class="score-detail"><span>ì„ì› í‰ê· </span><span>${result.executiveAvg.toFixed(1)}ì </span></div>
                    <div class="score-detail"><span>ì§ì› í‰ê· </span><span>${result.employeeAvg.toFixed(1)}ì </span></div>
                    <div class="score-detail"><span>ì„ì› ë°˜ì˜ (50%)</span><span>${(result.executiveAvg * 0.5).toFixed(1)}ì </span></div>
                    <div class="score-detail"><span>ì§ì› ë°˜ì˜ (40%)</span><span>${(result.employeeAvg * 0.4).toFixed(1)}ì </span></div>
                    <div class="score-detail"><span>ì‹œë¯¼ ë°˜ì˜ (10%)</span><span>${((citizenScores[result.department] || 0) * 0.1).toFixed(1)}ì </span></div>
                    <div class="final-score">ìµœì¢… ì ìˆ˜: ${result.finalScore.toFixed(1)}ì </div>
                `;
                container.appendChild(card);
            });
        };

        window.revealGrandPrize = function() {
            const first = finalVotes.filter(v => v.choice === 'firstHalf').length;
            const second = finalVotes.filter(v => v.choice === 'secondHalf').length;
            let winner = "ë¬´ìŠ¹ë¶€";
            let color = "#aaa";
            if(first > second) { winner = "ğŸ¥‡ ìƒë°˜ê¸° ìµœìš°ìˆ˜ì‘ ğŸ¥‡"; color = "linear-gradient(135deg, #FFD700, #FFA500)"; }
            else if (second > first) { winner = "ğŸ¥‡ í•˜ë°˜ê¸° ìµœìš°ìˆ˜ì‘ ğŸ¥‡"; color = "linear-gradient(135deg, #FFD700, #FFA500)"; }
            document.getElementById('finalGrandPrizeArea').innerHTML = `
                <div style="background: ${color}; color: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: popIn 0.5s;">
                    <h1 style="font-size: 3em; margin-bottom: 20px;">${winner}</h1>
                    <div style="font-size: 1.5em;">ìƒë°˜ê¸°(${finalVoteConfig.candidate1}): ${first}í‘œ vs í•˜ë°˜ê¸°(${finalVoteConfig.candidate2}): ${second}í‘œ</div>
                </div>`;
        };

        window.showFinalRanking = function() {
            window.calculateResults(); // Refresh data first
            // Just trigger the calculation view as per requirement, or we can add the animation logic back if needed.
            // For brevity, just scrolling to results.
            document.getElementById('resultsArea').scrollIntoView({behavior: 'smooth'});
        };
    </script>
</body>
</html>